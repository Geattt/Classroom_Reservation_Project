<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Table</title>
    <link rel="stylesheet" href="admin_style_home.css">
    <script type="text/javascript" src="admin.js" defer></script>
    <style>
    /* Style for the Modal */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent background */
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Ensure it is on top */
    }

    .modal img {
        max-width: 80%; /* Control the size of the image */
        max-height: 80%; /* Ensure the image fits within the modal */
    }

    .close {
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 40px;
        color: white;
        cursor: pointer;
    }

    /* Optional: Style the clickable image */
    .clickable-image {
        cursor: pointer;
        transition: transform 0.3s ease; /* Smooth zoom effect */
    }

    .clickable-image:hover {
        transform: scale(1.05); /* Zoom effect on hover */
    }
    </style>
</head>
<body>
    
    <nav id="sidebar">
        <ul>
          <li>
            <span class="logo">NTOU Classroom</span>
            <button onclick=toggleSidebar() id="toggle-btn">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="m313-480 155 156q11 11 11.5 27.5T468-268q-11 11-28 11t-28-11L228-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l184-184q11-11 27.5-11.5T468-692q11 11 11 28t-11 28L313-480Zm264 0 155 156q11 11 11.5 27.5T732-268q-11 11-28 11t-28-11L492-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l184-184q11-11 27.5-11.5T732-692q11 11 11 28t-11 28L577-480Z"/></svg>
            </button>
          </li>
          <li>
            <a href="#">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-240v-32q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v32q0 33-23.5 56.5T720-160H240q-33 0-56.5-23.5T160-240Zm80 0h480v-32q0-11-5.5-20T700-306q-54-27-109-40.5T480-360q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Zm0 400Z"/></svg>
              <span onclick="window.location.href = 'admin'">User</span>
            </a>
          </li>
          <li class="active">
            <a href="#">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M520-640v-160q0-17 11.5-28.5T560-840h240q17 0 28.5 11.5T840-800v160q0 17-11.5 28.5T800-600H560q-17 0-28.5-11.5T520-640ZM120-480v-320q0-17 11.5-28.5T160-840h240q17 0 28.5 11.5T440-800v320q0 17-11.5 28.5T400-440H160q-17 0-28.5-11.5T120-480Zm400 320v-320q0-17 11.5-28.5T560-520h240q17 0 28.5 11.5T840-480v320q0 17-11.5 28.5T800-120H560q-17 0-28.5-11.5T520-160Zm-400 0v-160q0-17 11.5-28.5T160-360h240q17 0 28.5 11.5T440-320v160q0 17-11.5 28.5T400-120H160q-17 0-28.5-11.5T120-160Zm80-360h160v-240H200v240Zm400 320h160v-240H600v240Zm0-480h160v-80H600v80ZM200-200h160v-80H200v80Zm160-320Zm240-160Zm0 240ZM360-280Z"/></svg>
              <span onclick="window.location.href = 'reservation'">Reservation</span>
            </a>
          </li>
          <li>
            <button onclick=toggleSubMenu(this) class="dropdown-btn">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h207q16 0 30.5 6t25.5 17l57 57h320q33 0 56.5 23.5T880-640v400q0 33-23.5 56.5T800-160H160Zm0-80h640v-400H447l-80-80H160v480Zm0 0v-480 480Zm400-160v40q0 17 11.5 28.5T600-320q17 0 28.5-11.5T640-360v-40h40q17 0 28.5-11.5T720-440q0-17-11.5-28.5T680-480h-40v-40q0-17-11.5-28.5T600-560q-17 0-28.5 11.5T560-520v40h-40q-17 0-28.5 11.5T480-440q0 17 11.5 28.5T520-400h40Z"/></svg>
              <span>Update</span>
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-361q-8 0-15-2.5t-13-8.5L268-556q-11-11-11-28t11-28q11-11 28-11t28 11l156 156 156-156q11-11 28-11t28 11q11 11 11 28t-11 28L508-372q-6 6-13 8.5t-15 2.5Z"/></svg>
            </button>
            <ul class="sub-menu">
              <div>
                <li><a href="#"><span onclick="window.location.href = 'blacklist'">User Blacklist</span></a></li>
                <li><a href="#"><span onclick="window.location.href = 'key'">Key Status</span></a></li>
                <li><a href="#">Project</a></li>
              </div>
            </ul>
          </li>
          <li>
          </li>
          <li>
            <a href="notification.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" class="bi bi-bell-fill" viewBox="0 0 16 16">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2m.995-14.901a1 1 0 1 0-1.99 0A5 5 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901"/>
                  </svg>
                                               
              <span>Notification</span>
            </a>
          </li>
          <li>
            <a href="classroom.html">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M240-200h120v-200q0-17 11.5-28.5T400-440h160q17 0 28.5 11.5T600-400v200h120v-360L480-740 240-560v360Zm-80 0v-360q0-19 8.5-36t23.5-28l240-180q21-16 48-16t48 16l240 180q15 11 23.5 28t8.5 36v360q0 33-23.5 56.5T720-120H560q-17 0-28.5-11.5T520-160v-200h-80v200q0 17-11.5 28.5T400-120H240q-33 0-56.5-23.5T160-200Zm320-270Z"/></svg>
              <span>Classroom</span>
            </a>
          </li>
        </ul>
      </nav>
      <main>
        <h1>User Information</h1>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Reservation ID</th>
                            <th>Status</th>
                            <th>Class Name</th>
                            <th>Reservation Date</th>
                            <th>Start Time</th>
                            <th>Name</th>
                            <th>Purpose</th>
                            <th>Number of Students</th>
                            <th>Picture</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (reservation && reservation.length > 0) { %>
                            <% reservation.forEach(function(reservation) { %>
                                <tr>
                                    <td><%= reservation.reservation_id %></td>
                                    <td>
                                        <select onchange="updateStatus('<%= reservation.reservation_id %>', this.value)">
                                          <option value="pending" <%= reservation.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                          <option value="approved" <%= reservation.status === 'approved' ? 'selected' : '' %>>Approved</option>
                                          <option value="rejected" <%= reservation.status === 'rejected' ? 'selected' : '' %>>Rejected</option>
                                        </select>
                                    </td>
                                    <td><%= reservation.class_name %></td>
                                    <td><%= reservation.reservation_date %></td>
                                    <td><%= reservation.start_time %></td>
                                    <td><%= reservation.name %></td>
                                    <td><%= reservation.purpose %></td>
                                    <td><%= reservation.number_of_students %></td>
                                    <td><% if (reservation.picture) { %>
                                      <img src="/image/<%= reservation.reservation_id %>" alt="Reservation Picture" style="width:100px;height:auto;" class="clickable-image">
                                      <% } else { %>
                                          No image available
                                      <% } %>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="9" style="text-align: center;">No data available</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
      </main>
    </nav>
    <!-- Modal Structure -->
<div id="imageModal" style="display: none;" class="modal">
  <span id="closeModal" class="close">&times;</span>
  <img id="modalImage" src="" alt="Enlarged Image" style="max-width: 100%; height: auto;">
</div>

     
</body>

<script>
    const updateStatus = (reservationId, newStatus) => {
      const formData = new FormData();
      formData.append('reservationId', reservationId);  // Append form fields to formData
      formData.append('newStatus', newStatus);
      for (const [key, value] of formData.entries()) {
      console.log(`${key}: ${value}`);
}

      fetch('/update-status', {
        method: 'POST',
        body: formData,  // Send as multipart/form-data
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert('Status updated successfully!');
          } else {
            alert('Error updating status');
          }
        })
        .catch((error) => console.error('Error:', error));
    };


    // Get the modal and elements
    const modal = document.getElementById("imageModal");
    const modalImage = document.getElementById("modalImage");
    const closeModal = document.getElementById("closeModal");

    // Get all images with the class 'clickable-image'
    const images = document.querySelectorAll('.clickable-image');

    // When an image is clicked, show the modal with the enlarged image
    images.forEach(image => {
        image.addEventListener('click', function() {
            // Set the src of the modal image to the clicked image's src
            modalImage.src = this.src;
            modal.style.display = "flex"; // Show the modal
        });
    });

    // Close the modal when the close button is clicked
    closeModal.addEventListener('click', function() {
        modal.style.display = "none"; // Hide the modal
    });

    // Close the modal if the user clicks outside of the image
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
  </script>

</html>
